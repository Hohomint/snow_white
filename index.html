<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°±ì„¤ê³µì£¼: ì´ì•¼ê¸°ì™€ ê´€ê³„ë„</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Nanum+Myeongjo:wght@700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --point-red: #d32f2f;
            --deep-forest: #1a2a1a;
            --forest-green: #2d4a2d;
            --gold: #fbc02d;
            --white: #ffffff;
            --text-main: #333;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            font-family: 'Gowun Batang', serif;
            background-color: var(--deep-forest);
            color: var(--white);
            scroll-behavior: smooth;
        }

        /* ë©”ì¸ ëŒ€ë¬¸ */
        .hero {
            height: 100vh;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(26, 42, 26, 1)),
                url('https://images.unsplash.com/photo-1518709779341-56cf4535e94b?auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
        }

        .hero h1 {
            font-family: 'Nanum Myeongjo';
            font-size: 6rem;
            color: var(--gold);
            margin: 0;
            letter-spacing: -2px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .hero p {
            font-size: 1.6rem;
            margin: 20px 0 50px;
            opacity: 0.9;
        }

        .main-menu {
            display: flex;
            gap: 20px;
        }

        .main-menu button {
            padding: 15px 40px;
            border: 2px solid var(--gold);
            background: rgba(0, 0, 0, 0.3);
            color: var(--gold);
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            font-family: 'Nanum Myeongjo';
            font-weight: bold;
            transition: 0.3s;
            backdrop-filter: blur(5px);
        }

        .main-menu button:hover {
            background: var(--gold);
            color: var(--deep-forest);
            box-shadow: 0 0 20px rgba(251, 192, 45, 0.5);
            transform: scale(1.05);
        }

        /* ê³ ì • ë©”ë‰´ ë°” */
        nav {
            background: rgba(26, 42, 26, 0.95);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            padding: 15px 0;
            border-bottom: 2px solid var(--gold);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .nav-link {
            color: #ccc;
            text-decoration: none;
            margin: 0 25px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .nav-link:hover {
            color: var(--gold);
        }

        /* ì„¹ì…˜ ê³µí†µ */
        .section {
            display: none;
            padding: 100px 20px;
            min-height: 80vh;
            background: #fdfdfd;
            color: #222;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.8s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        h2 {
            text-align: center;
            font-family: 'Nanum Myeongjo';
            font-size: 3rem;
            color: var(--deep-forest);
            margin-bottom: 50px;
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
        }

        h2::after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background: var(--point-red);
            margin: 20px auto 0;
        }

        /* ê´€ê³„ë„ ì˜ì—­ */
        #map-container {
            background: radial-gradient(circle at center, #fff, #f4f4f4);
            border-radius: 30px;
            border: 1px solid #ddd;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            height: 700px;
            margin-top: 30px;
            overflow: hidden;
            position: relative;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            pointer-events: none;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }

        /* êµí›ˆ ì¹´ë“œ */
        .moral-grid {
            display: flex;
            gap: 30px;
            margin-top: 50px;
            flex-wrap: wrap;
        }

        .moral-card {
            flex: 1;
            min-width: 300px;
            background: #fff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-top: 5px solid var(--gold);
            border-bottom: 1px solid #eee;
        }

        .moral-card:hover {
            transform: translateY(-15px);
            border-color: var(--point-red);
        }

        .moral-card h3 {
            color: var(--deep-forest);
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .moral-card p {
            color: #666;
            line-height: 1.6;
        }

        .moral-card p {
            color: #666;
            line-height: 1.6;
        }

        /* ì±—ë´‡ ìœ„ì ¯ ìŠ¤íƒ€ì¼ */
        .chat-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chat-toggle-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--gold);
            border: 4px solid white;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 35px;
            transition: 0.3s;
            position: relative;
            z-index: 1001;
        }

        .chat-toggle-btn:hover {
            transform: scale(1.1) rotate(10deg);
            background: var(--point-red);
            color: white;
        }

        .chat-label {
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--deep-forest);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            font-family: 'Nanum Myeongjo';
            border: 1px solid var(--gold);
            cursor: pointer;
            transition: 0.3s;
        }

        .chat-label:hover {
            color: var(--point-red);
            transform: scale(1.05);
        }

        .chat-popup {
            width: 380px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform-origin: bottom center;
            transform: scale(0);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid #ddd;
            pointer-events: none;
            /* ë‹«í˜€ìˆì„ ë•Œ í´ë¦­ ë°©ì§€ */
        }

        .chat-popup.active {
            transform: scale(1);
            opacity: 1;
            pointer-events: all;
        }

        .chat-header {
            background: var(--deep-forest);
            color: var(--gold);
            padding: 15px 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Nanum Myeongjo';
        }

        .chat-window {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #fdfdfd;
            font-size: 0.95rem;
        }

        .chat-message {
            margin-bottom: 15px;
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 15px;
            line-height: 1.4;
            word-break: break-word;
            animation: fadeInMsg 0.3s ease;
        }

        @keyframes fadeInMsg {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message.bot {
            background: #f0f4f8;
            color: #333;
            border-bottom-left-radius: 2px;
            margin-right: auto;
        }

        .chat-message.user {
            background: var(--gold);
            color: var(--deep-forest);
            border-bottom-right-radius: 2px;
            margin-left: auto;
            font-weight: bold;
        }

        .chat-input-area {
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 8px;
        }

        .chat-input-area input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-family: 'Gowun Batang';
        }

        .chat-input-area button {
            padding: 0 20px;
            background: var(--deep-forest);
            color: white;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* ì‚¬ìš´ë“œ í† ê¸€ ë²„íŠ¼ */
        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            background: rgba(0, 0, 0, 0.5);
            color: var(--gold);
            border: 1px solid var(--gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: 0.3s;
        }

        .sound-toggle:hover {
            background: var(--gold);
            color: var(--deep-forest);
            transform: scale(1.1);
        }
    </style>
</head>

<body>

    <section class="hero">
        <h1>ë°±ì„¤ê³µì£¼</h1>
        <p>ê±°ìš¸ì•„ ê±°ìš¸ì•„, ì„¸ìƒì—ì„œ ëˆ„ê°€ ì œì¼ ì•„ë¦„ë‹µë‹ˆ?</p>
        <div class="main-menu">
            <button onclick="openTab('story'); playSound('click')">ì´ì•¼ê¸° ì½ê¸°</button>
            <button onclick="openTab('rel'); playSound('click')">ì¸ë¬¼ ê´€ê³„ë„</button>
            <button onclick="openTab('lesson'); playSound('click')">êµí›ˆ ë³´ê¸°</button>
        </div>
    </section>

    <div class="sound-toggle" onclick="toggleMute()" title="ì†Œë¦¬ ì¼œê¸°/ë„ê¸°">
        <span id="sound-icon">ğŸ”Š</span>
    </div>

    <nav id="top-nav" style="visibility: hidden;">
        <a class="nav-link" onclick="openTab('story')">ìŠ¤í† ë¦¬</a>
        <a class="nav-link" onclick="openTab('rel')">ì¸ë¬¼ ê´€ê³„ë„</a>
        <a class="nav-link" onclick="openTab('lesson')">êµí›ˆ</a>
        <a class="nav-link" style="color:var(--gold)" onclick="window.scrollTo({top:0, behavior:'smooth'})">TOP</a>
    </nav>

    <div id="story" class="section">
        <div class="container">
            <h2>ì˜ì›í•œ ë™í™”ì˜ ì‹œì‘</h2>
            <div style="line-height: 2.2; font-size: 1.2rem; color: #444; text-align: justify; padding: 0 50px;">
                <p>
                    ì˜›ë‚  ì–´ëŠ ê²¨ìš¸, í•œ ì™•ë¹„ê°€ ì°½ê°€ì— ì•‰ì•„ ë°”ëŠì§ˆì„ í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ì°½í‹€ì€ í‘ë‹¨ë‚˜ë¬´ë¡œ ë˜ì–´ ìˆì—ˆê³ , ë°–ì—ëŠ” í° ëˆˆì´ ë‚´ë¦¬ê³  ìˆì—ˆìŠµë‹ˆë‹¤.
                    ì™•ë¹„ê°€ ë°”ëŠ˜ì— ì†ì„ ì°”ë ¤ ë¶‰ì€ í”¼ ì„¸ ë°©ìš¸ì´ ëˆˆ ìœ„ì— ë–¨ì–´ì¡ŒìŠµë‹ˆë‹¤. ê·¸ ë¶‰ì€ ìƒ‰ì´ í° ëˆˆê³¼ ì–´ìš°ëŸ¬ì ¸ ë„ˆë¬´ë‚˜ ì•„ë¦„ë‹¤ì›Œ ë³´ì˜€ê¸°ì— ì™•ë¹„ëŠ” ì†Œì›ì„ ë¹Œì—ˆìŠµë‹ˆë‹¤.
                    <br><br>
                    <em>"ëˆˆì²˜ëŸ¼ í•˜ì–€ í”¼ë¶€, í”¼ì²˜ëŸ¼ ë¶‰ì€ ì…ìˆ , í‘ë‹¨ì²˜ëŸ¼ ê²€ì€ ë¨¸ë¦¬ì¹´ë½ì„ ê°€ì§„ ì•„ì´ë¥¼ ë‚³ê²Œ í•´ì£¼ì„¸ìš”."</em>
                    <br><br>
                    ê·¸ë ‡ê²Œ íƒœì–´ë‚œ ì•„ì´ê°€ ë°”ë¡œ <strong>ë°±ì„¤ê³µì£¼</strong>ì…ë‹ˆë‹¤.
                    ê·¸ëŸ¬ë‚˜ ì™•ë¹„ê°€ ì„¸ìƒì„ ë– ë‚˜ê³  ìƒˆë¡œ ë“¤ì–´ì˜¨ <strong>ìƒˆ ì™•ë¹„</strong>ëŠ” ì•„ë¦„ë‹µì§€ë§Œ ë§¤ìš° êµë§Œí•˜ê³  ì§ˆíˆ¬ì‹¬ì´ ë§ì€ ë§ˆë…€ì˜€ìŠµë‹ˆë‹¤.
                    ê·¸ë…€ì—ê²ŒëŠ” ì§„ì‹¤ë§Œì„ ë§í•˜ëŠ” <strong>ë§ˆë²•ì˜ ê±°ìš¸</strong>ì´ ìˆì—ˆëŠ”ë°, ë§¤ì¼ ìì‹ ì˜ ì•„ë¦„ë‹¤ì›€ì„ í™•ì¸ë°›ê³¤ í–ˆìŠµë‹ˆë‹¤.
                    ì–´ëŠ ë‚  ê±°ìš¸ì´ ë°±ì„¤ê³µì£¼ê°€ ê°€ì¥ ì•„ë¦„ë‹µë‹¤ê³  ë§í•˜ì, ì™•ë¹„ì˜ ì§ˆíˆ¬ëŠ” ê±·ì¡ì„ ìˆ˜ ì—†ëŠ” ë¶„ë…¸ë¡œ ë³€í–ˆìŠµë‹ˆë‹¤.
                    <br><br>
                    ìˆ²ìœ¼ë¡œ ì«“ê²¨ë‚œ ê³µì£¼ëŠ” <strong>ì¼ê³± ë‚œìŸì´</strong>ë“¤ì„ ë§Œë‚˜ í‰í™”ë¡œìš´ ë‚˜ë‚ ì„ ë³´ë‚´ì§€ë§Œ,
                    ì™•ë¹„ëŠ” ë…¸íŒŒë¡œ ë³€ì¥í•´ <strong>ë…ì‚¬ê³¼</strong>ë¥¼ ê±´ë„¤ê³  ê³µì£¼ëŠ” ê¹Šì€ ì ì— ë¹ ì§€ê²Œ ë©ë‹ˆë‹¤.
                    ê²°êµ­ ì§„ì •í•œ ì‚¬ë‘ì„ í’ˆì€ <strong>ì´ì›ƒ ë‚˜ë¼ ì™•ì</strong>ì˜ ë“±ì¥ìœ¼ë¡œ ê³µì£¼ëŠ” ê¹¨ì–´ë‚˜ê³ , ê·¸ë“¤ì€ ì˜¤ë˜ì˜¤ë˜ í–‰ë³µí•˜ê²Œ ì‚´ì•˜ìŠµë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </div>

    <div id="rel" class="section">
        <div class="container">
            <h2>ì¸ë¬¼ ë° ì‚¬ë¬¼ ê´€ê³„ë„</h2>
            <p style="text-align: center; color: #666; margin-bottom: 20px;">
                ë“œë˜ê·¸í•˜ì—¬ ê´€ê³„ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”. í™”ì‚´í‘œëŠ” í–‰ë™ì´ë‚˜ ê°ì •ì˜ ë°©í–¥ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
            </p>
            <div id="tooltip" class="tooltip"></div>
            <div id="map-container"></div>
        </div>
    </div>

    <div id="lesson" class="section">
        <div class="container">
            <h2>ì´ì•¼ê¸°ê°€ ë‚¨ê¸´ ë©”ì‹œì§€</h2>
            <div class="moral-grid">
                <div class="moral-card">
                    <h3>ì§„ì •í•œ ì•„ë¦„ë‹¤ì›€</h3>
                    <p>ì™¸ë©´ì˜ ì•„ë¦„ë‹¤ì›€ì€ ì‹œë“¤ì§€ë§Œ, ì¹œì ˆí•˜ê³  ìˆœìˆ˜í•œ ë‚´ë©´ì˜ ì•„ë¦„ë‹¤ì›€ì€ ì„¸ìƒì„ ë³€í™”ì‹œí‚¤ëŠ” í˜ì´ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div class="moral-card">
                    <h3>ê¶Œì„ ì§•ì•…</h3>
                    <p>íƒ€ì¸ì„ í•´ì¹˜ë ¤ëŠ” ì•…í•œ ë§ˆìŒê³¼ ì§ˆíˆ¬ëŠ” ê²°êµ­ ìê¸° ìì‹ ì—ê²Œ ë˜ëŒì•„ì™€ ìŠ¤ìŠ¤ë¡œë¥¼ íŒŒë©¸ì‹œí‚µë‹ˆë‹¤.</p>
                </div>
                <div class="moral-card">
                    <h3>ì‚¬ë‘ê³¼ í¬ë§</h3>
                    <p>ì–´ë‘  ì†ì—ì„œë„ í¬ë§ì„ ìƒì§€ ì•Šê³ , ì§„ì‹¤í•œ ì‚¬ë‘ê³¼ ìš°ì •ì´ ìˆë‹¤ë©´ ì–´ë–¤ ì‹œë ¨ë„ ê·¹ë³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- í”Œë¡œíŒ… ì±—ë´‡ ìœ„ì ¯ -->
    <div class="chat-widget">
        <div class="chat-popup" id="chat-popup">
            <div class="chat-header">
                <span>ğŸ§š ì´ì•¼ê¸° ìš”ì •</span>
                <span style="cursor:pointer" onclick="toggleChat()">âœ•</span>
            </div>
            <div id="chat-window" class="chat-window">
                <div class="chat-message bot">
                    ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”.<br>
                    <small>ì˜ˆ: "ì´ë¦„ì´ ì™œ ë°±ì„¤ê³µì£¼ì•¼?", "ì™•ë¹„ëŠ” ëˆ„êµ¬ì•¼?", "êµí›ˆ ì•Œë ¤ì¤˜"</small>
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="user-input" placeholder="ì§ˆë¬¸í•˜ê¸°..." onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()">ì „ì†¡</button>
            </div>
        </div>
        <div class="chat-toggle-btn" onclick="toggleChat()">
            <span style="font-size: 2rem;">ğŸ§š</span>
        </div>
        <div class="chat-label" onclick="toggleChat()">ì´ì•¼ê¸° ìš”ì •</div>
    </div>

    <!-- ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ íˆ¬ëª… ë²„íŠ¼ (ì²« ì¸í„°ë™ì…˜ìš©) -->
    <div id="audio-init-overlay"
        style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:9999; display:none;"
        onclick="initAudio()"></div>

    <script>
        function openTab(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('top-nav').style.visibility = 'visible';

            // Scroll to nav
            const nav = document.getElementById('top-nav');
            const offset = nav.getBoundingClientRect().height;
            const bodyRect = document.body.getBoundingClientRect().top;
            const elementRect = document.getElementById(id).getBoundingClientRect().top;
            const elementPosition = elementRect - bodyRect;
            const offsetPosition = elementPosition - offset - 20;

            window.scrollTo({
                top: offsetPosition,
                behavior: "smooth"
            });

            if (id === 'rel') setTimeout(renderMap, 100);
        }

        // --- ì±—ë´‡ ë¡œì§ ---
        function toggleChat() {
            const popup = document.getElementById('chat-popup');
            popup.classList.toggle('active');
            if (popup.classList.contains('active')) {
                document.getElementById('user-input').focus();
                playSound('pop');
            } else {
                playSound('click');
            }
        }

        const knowledgeBase = [
            {
                keywords: ["ì•ˆë…•", "ë°˜ê°€ì›Œ", "í•˜ì´", "ã…ã…‡"],
                answer: "ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ë°±ì„¤ê³µì£¼ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ëŠ” ìš”ì •ì´ì—ìš”. ì´ì•¼ê¸° ì† ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë´ì£¼ì„¸ìš”! ğŸ§š"
            },
            {
                keywords: ["ì´ë¦„", "ë°±ì„¤ê³µì£¼ ëœ»", "ì™œ ë°±ì„¤", "í•˜ì–€ í”¼ë¶€", "ì™¸ëª¨"],
                answer: "ëˆˆì²˜ëŸ¼ í•˜ì–€ í”¼ë¶€, í”¼ì²˜ëŸ¼ ë¶‰ì€ ì…ìˆ , í‘ë‹¨ì²˜ëŸ¼ ê²€ì€ ë¨¸ë¦¬ì¹´ë½ì„ ê°€ì§€ê³  íƒœì–´ë‚˜ì„œ 'ë°±ì„¤ê³µì£¼'ë¼ê³  ë¶ˆë¦¬ê²Œ ë˜ì—ˆë‹µë‹ˆë‹¤."
            },
            {
                keywords: ["ê²°ë§", "ë", "ë§ˆì§€ë§‰", "ì–´ë–»ê²Œ ë¼", "í•´í”¼ì—”ë”©", "ê²°í˜¼"],
                answer: "ì™•ìê°€ ë°±ì„¤ê³µì£¼ì˜ ì£½ìŒì„ ìŠ¬í¼í•˜ë©° ê´€ì„ ì˜®ê¸°ë˜ ì¤‘, í”ë“¤ë¦¼ìœ¼ë¡œ ì¸í•´ ê³µì£¼ì˜ ëª©ì— ê±¸ë¦° ë…ì‚¬ê³¼ ì¡°ê°ì´ íŠ€ì–´ë‚˜ì™”ì–´ìš”. ê³µì£¼ëŠ” ê¹¨ì–´ë‚¬ê³ , ì™•ìì™€ ê²°í˜¼í•˜ì—¬ ì˜¤ë˜ì˜¤ë˜ í–‰ë³µí•˜ê²Œ ì‚´ì•˜ë‹µë‹ˆë‹¤."
            },
            {
                keywords: ["ì™•ë¹„", "ì™œ", "ì´ìœ ", "ë…ì‚¬ê³¼", "ì£½ì´ë ¤ê³ ", "ë¯¸ì›Œ", "ì§ˆíˆ¬", "ê³„ëª¨", "ë§ˆë…€", "ìƒˆì—„ë§ˆ"],
                answer: "ì™•ë¹„ëŠ” ì„¸ìƒì—ì„œ ìì‹ ì´ ê°€ì¥ ì•„ë¦„ë‹¤ì›Œì•¼ í•œë‹¤ê³  ìƒê°í–ˆì–´ìš”. ê·¸ëŸ°ë° ë§ˆë²•ì˜ ê±°ìš¸ì´ ë°±ì„¤ê³µì£¼ê°€ ë” ì•„ë¦„ë‹µë‹¤ê³  í•˜ì, ì§ˆíˆ¬ì‹¬ì— ëˆˆì´ ë©€ì–´ ê³µì£¼ë¥¼ ì—†ì• ë ¤ê³  ë…ì‚¬ê³¼ë¥¼ ë¨¹ì¸ ê²ƒì´ëë‹ˆë‹¤."
            },
            {
                keywords: ["ë‚œìŸì´", "ì¼ê³±", "ëˆ„êµ¬", "ì¹œêµ¬", "ì˜¤ë‘ë§‰"],
                answer: "ì¼ê³± ë‚œìŸì´ëŠ” ìˆ²ì† ì˜¤ë‘ë§‰ì— ì‚´ë©° ê´‘ì‚°ì—ì„œ ë³´ì„ì„ ìºëŠ” ì¼ì„ í•´ìš”. ì«“ê²¨ë‚œ ë°±ì„¤ê³µì£¼ë¥¼ ë°›ì•„ì£¼ê³  ê°€ì¡±ì²˜ëŸ¼ ëŒë´ì¤€ ë”°ëœ»í•œ ì¹œêµ¬ë“¤ì…ë‹ˆë‹¤."
            },
            {
                keywords: ["ê±°ìš¸", "ë§ˆë²•", "ê¸°ëŠ¥", "ì§„ì‹¤", "ëˆ„ê°€ ì œì¼ ì˜ˆë»"],
                answer: "ë§ˆë²•ì˜ ê±°ìš¸ì€ ì„¸ìƒì˜ ëª¨ë“  ì§„ì‹¤ì„ ì•Œê³  ìˆì–´ìš”. ì™•ë¹„ê°€ 'ê±°ìš¸ì•„ ê±°ìš¸ì•„, ì„¸ìƒì—ì„œ ëˆ„ê°€ ì œì¼ ì˜ˆì˜ë‹ˆ?'ë¼ê³  ë¬¼ìœ¼ë©´ ê±°ì§“ ì—†ì´ ëŒ€ë‹µì„ í•´ì£¼ëŠ” ì‹ ë¹„í•œ ë¬¼ê±´ì…ë‹ˆë‹¤."
            },
            {
                keywords: ["ì™•ì", "ì—­í• ", "ë‚¨ì£¼", "êµ¬ì›"],
                answer: "ì™•ìëŠ” ì´ì›ƒ ë‚˜ë¼ ì‚¬ëŒìœ¼ë¡œ, ë°±ì„¤ê³µì£¼ë¥¼ ë³´ê³  ì²«ëˆˆì— ë°˜í–ˆì–´ìš”. ê·¸ì˜ ì§„ì‹¤í•œ ì‚¬ë‘ê³¼ ê´€ì‹¬ì´ ê²°êµ­ ê³µì£¼ë¥¼ ì£½ìŒ(ì )ì—ì„œ ê¹¨ì–´ë‚˜ê²Œ ë§Œë“¤ì—ˆë‹µë‹ˆë‹¤."
            },
            {
                keywords: ["ì‚¬ëƒ¥ê¾¼", "ìˆ²", "ë„ë§", "ì«’ê²¨", "ì«“ê²¨"],
                answer: "ì›ë˜ ì™•ë¹„ëŠ” ì‚¬ëƒ¥ê¾¼ì„ ì‹œì¼œ ê³µì£¼ë¥¼ ì—†ì• ë ¤ í–ˆì§€ë§Œ, ì‚¬ëƒ¥ê¾¼ì€ ì–´ë¦° ê³µì£¼ë¥¼ ë¶ˆìŒíˆ ì—¬ê²¨ ìˆ²ìœ¼ë¡œ ë„ë§ê°€ê²Œ ë†“ì•„ì£¼ì—ˆë‹µë‹ˆë‹¤."
            },
            {
                keywords: ["ë³€ì¥", "í• ë¨¸ë‹ˆ", "ë…¸íŒŒ", "ì†ì„ìˆ˜"],
                answer: "ì™•ë¹„ëŠ” ë°±ì„¤ê³µì£¼ë¥¼ ì•ˆì‹¬ì‹œí‚¤ê¸° ìœ„í•´ í—ˆë¦„í•œ ì‹œê³¨ ë…¸íŒŒë¡œ ë³€ì¥í•´ì„œ ìˆ²ì† ì˜¤ë‘ë§‰ì„ ì°¾ì•„ê°€ ë…ì‚¬ê³¼ë¥¼ ê±´ë„¸ì–´ìš”."
            },
            {
                keywords: ["êµí›ˆ", "ë°°ìš¸ì ", "ë©”ì‹œì§€", "ì£¼ì œ"],
                answer: "ì´ ì´ì•¼ê¸°ëŠ” 'ì§„ì •í•œ ì•„ë¦„ë‹¤ì›€ì€ ê³ ìš´ ë§ˆìŒì”¨ì—ì„œ ë‚˜ì˜¨ë‹¤'ëŠ” ê²ƒê³¼ 'ë‚¨ì„ í•´ì¹˜ë ¤ëŠ” ì•…í•œ ë§ˆìŒì€ ê²°êµ­ ë²Œì„ ë°›ëŠ”ë‹¤'ëŠ” êµí›ˆì„ ë‹´ê³  ìˆì–´ìš”."
            }
        ];

        // --- ì‚¬ìš´ë“œ ì‹œìŠ¤í…œ (Web Audio API) ---
        let audioCtx;
        let isMuted = false;

        function initAudio() {
            if (!audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        // í˜ì´ì§€ ì•„ë¬´ê³³ì´ë‚˜ í´ë¦­í•˜ë©´ ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ í™œì„±í™” ì‹œë„
        document.addEventListener('click', initAudio, { once: true });

        function toggleMute() {
            isMuted = !isMuted;
            const icon = document.getElementById('sound-icon');
            if (isMuted) {
                icon.textContent = 'ğŸ”‡';
                if (audioCtx) audioCtx.suspend();
            } else {
                icon.textContent = 'ğŸ”Š';
                if (audioCtx) audioCtx.resume();
            }
        }

        function playSound(type) {
            if (isMuted || !audioCtx) return;

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'hover') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.05);
                gainNode.gain.setValueAtTime(0.05, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                osc.start(now);
                osc.stop(now + 0.05);
            } else if (type === 'click') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
                gainNode.gain.setValueAtTime(0.2, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'pop') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'msg_send') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(440, now);
                osc.frequency.setValueAtTime(880, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'msg_receive') {
                // ë ë§~ (í™”ìŒ íš¨ê³¼)
                playTone(523.25, 0, 0.3); // C5
                setTimeout(() => playTone(659.25, 0, 0.3), 100); // E5
            }
        }

        function playTone(freq, delay, duration) {
            if (isMuted || !audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime + delay;
            osc.frequency.setValueAtTime(freq, now);
            gainNode.gain.setValueAtTime(0.1, now);
            gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);
            osc.start(now);
            osc.stop(now + duration);
        }

        // ë²„íŠ¼ë“¤ì— í˜¸ë²„ ì‚¬ìš´ë“œ ì¶”ê°€
        document.querySelectorAll('button, .nav-link, .chat-toggle-btn').forEach(btn => {
            btn.addEventListener('mouseenter', () => playSound('hover'));
        });

        function handleKeyPress(event) {
            if (event.key === "Enter") sendMessage();
        }

        function sendMessage() {
            const inputField = document.getElementById("user-input");
            const message = inputField.value.trim();
            if (message === "") return;

            addMessage(message, "user");
            playSound('msg_send');
            inputField.value = "";

            // 0.5ì´ˆ ë”œë ˆì´ í›„ ë‹µë³€
            setTimeout(() => {
                const response = getBotResponse(message);
                addMessage(response, "bot");
                playSound('msg_receive');
            }, 500);
        }

        function addMessage(text, sender) {
            const chatWindow = document.getElementById("chat-window");
            const div = document.createElement("div");
            div.className = `chat-message ${sender}`;
            div.innerHTML = text; // innerHTML allows <br>
            chatWindow.appendChild(div);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function getBotResponse(input) {
            // ê°„ë‹¨í•œ í‚¤ì›Œë“œ ë§¤ì¹­
            for (const item of knowledgeBase) {
                for (const keyword of item.keywords) {
                    if (input.includes(keyword)) {
                        return item.answer;
                    }
                }
            }
            return "ì£„ì†¡í•´ìš”, ê·¸ ì§ˆë¬¸ì€ ì•„ì§ ì œê°€ ë°°ìš°ì§€ ëª»í–ˆì–´ìš”. ğŸ˜¢<br>ë‹¤ë¥¸ ì§ˆë¬¸ì„ í•´ë³´ì‹œê² ì–´ìš”?<br><small>ì˜ˆ: ë°±ì„¤ê³µì£¼ì˜ ì˜ë¯¸, ì‚¬ëƒ¥ê¾¼ ì´ì•¼ê¸°, ë…ì‚¬ê³¼ë¥¼ ë§Œë“  ì‚¬ëŒ ë“±</small>";
        }

        function renderMap() {
            d3.select("#map-container").selectAll("*").remove();
            const container = document.getElementById('map-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            // --- ë°ì´í„° ì •ì˜ (ìƒˆë¡œìš´ ì´ë¯¸ì§€ ì ìš©) ---
            // ì´ë¯¸ì§€ ê²½ë¡œ: images/filename.png
            const nodes = [
                { id: "ë°±ì„¤ê³µì£¼", img: "images/snow_white.png", group: "protagonist", role: "ì£¼ì¸ê³µ" },
                { id: "ì™•ë¹„", img: "images/evil_queen.png", group: "antagonist", role: "ì•…ë‹¹/ê³„ëª¨" },
                { id: "ë‚œìŸì´ë“¤", img: "images/seven_dwarfs.png", group: "helper", role: "ì¡°ë ¥ì" },
                { id: "ì™•ì", img: "images/prince.png", group: "hero", role: "êµ¬ì›ì" },
                { id: "ë§ˆë²•ê±°ìš¸", img: "images/magic_mirror.png", group: "item", role: "ì§„ì‹¤ì˜ ë„êµ¬" },
                { id: "ë…ì‚¬ê³¼", img: "images/poison_apple.svg", group: "weapon", role: "ì¹˜ëª…ì  ë¬´ê¸°" }
            ];

            const links = [
                { source: "ì™•ë¹„", target: "ë°±ì„¤ê³µì£¼", label: "ì§ˆíˆ¬/ì‚´í•´ì‹œë„", color: "#d32f2f" },
                { source: "ë°±ì„¤ê³µì£¼", target: "ì™•ë¹„", label: "ê³„ëª¨", color: "#888" },
                { source: "ì™•ë¹„", target: "ë§ˆë²•ê±°ìš¸", label: "ì†Œìœ ", color: "#555" },
                { source: "ë§ˆë²•ê±°ìš¸", target: "ì™•ë¹„", label: "ì§„ì‹¤ ì¡°ì–¸", color: "#aaa" },
                { source: "ë‚œìŸì´ë“¤", target: "ë°±ì„¤ê³µì£¼", label: "ë³´í˜¸/ìš°ì •", color: "#4caf50" },
                { source: "ì™•ì", target: "ë°±ì„¤ê³µì£¼", label: "ì‚¬ë‘/í‚¤ìŠ¤", color: "#e91e63" },
                { source: "ì™•ë¹„", target: "ë…ì‚¬ê³¼", label: "ì œì‘", color: "#5d4037" },
                { source: "ë…ì‚¬ê³¼", target: "ë°±ì„¤ê³µì£¼", label: "ìœ„í˜‘", color: "#d32f2f" }
            ];

            const svg = d3.select("#map-container").append("svg")
                .attr("width", width)
                .attr("height", height)
                .call(d3.zoom().on("zoom", (event) => {
                    g.attr("transform", event.transform);
                }))
                .append("g");

            const g = svg.append("g");

            // --- í™”ì‚´í‘œ ë§ˆì»¤ ì •ì˜ ---
            const defs = svg.append("defs");

            // ë§í¬ ìƒ‰ìƒë³„ ë§ˆì»¤ ìƒì„±
            const distinctColors = [...new Set(links.map(l => l.color))];
            distinctColors.forEach(color => {
                const safeColor = color.replace("#", "");
                defs.append("marker")
                    .attr("id", "arrow-" + safeColor)
                    .attr("viewBox", "0 -5 10 10")
                    .attr("refX", 58) // ë…¸ë“œ ë°˜ì§€ë¦„(40) + ì—¬ìœ 
                    .attr("refY", 0)
                    .attr("markerWidth", 8)
                    .attr("markerHeight", 8)
                    .attr("orient", "auto")
                    .append("path")
                    .attr("d", "M0,-5L10,0L0,5")
                    .attr("fill", color);
            });

            // --- ì´ë¯¸ì§€ íŒ¨í„´ ì •ì˜ ---
            nodes.forEach(d => {
                defs.append("pattern")
                    .attr("id", "p-" + d.id)
                    .attr("height", 1)
                    .attr("width", 1)
                    .attr("patternContentUnits", "objectBoundingBox")
                    .append("image")
                    .attr("height", 1)
                    .attr("width", 1)
                    .attr("preserveAspectRatio", "xMidYMid slice")
                    .attr("xlink:href", d.img);
            });

            const simulation = d3.forceSimulation(nodes)
                .force("link", d3.forceLink(links).id(d => d.id).distance(220))
                .force("charge", d3.forceManyBody().strength(-2000))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collide", d3.forceCollide(60));

            // --- ë§í¬ ê·¸ë¦¬ê¸° ---
            // ê³¡ì„  íš¨ê³¼ë¥¼ ìœ„í•´ path ì‚¬ìš© ê°€ëŠ¥í•˜ë‚˜ ê°„ë‹¨íˆ line ì‚¬ìš©
            const linkGroup = g.append("g").selectAll("g")
                .data(links)
                .enter().append("g");

            const linkLine = linkGroup.append("line")
                .attr("stroke", d => d.color)
                .attr("stroke-width", 2.5)
                .attr("marker-end", d => `url(#arrow-${d.color.replace("#", "")})`);

            // ë§í¬ ë¼ë²¨ ë°°ê²½ (ê°€ë…ì„±)
            const linkLabelRect = linkGroup.append("rect")
                .attr("rx", 5)
                .attr("ry", 5)
                .attr("fill", "rgba(255,255,255,0.8)");

            const linkText = linkGroup.append("text")
                .text(d => d.label)
                .attr("text-anchor", "middle")
                .attr("dy", 4)
                .style("font-size", "0.85rem")
                .style("fill", "#444")
                .style("font-weight", "bold");

            // --- ë…¸ë“œ ê·¸ë¦¬ê¸° ---
            const node = g.append("g").selectAll("circle")
                .data(nodes)
                .enter().append("circle")
                .attr("r", 45) // ë°˜ì§€ë¦„ í‚¤ì›€
                .attr("fill", d => `url(#p-${d.id})`)
                .attr("stroke", d => {
                    if (d.group === 'antagonist') return "#d32f2f";
                    if (d.group === 'protagonist') return "#fbc02d";
                    return "#ddd";
                })
                .attr("stroke-width", 4)
                .style("filter", "drop-shadow(3px 3px 5px rgba(0,0,0,0.3))")
                .call(d3.drag()
                    .on("start", dragStart)
                    .on("drag", dragging)
                    .on("end", dragEnd))
                .on("mouseover", (e, d) => {
                    const tooltip = document.getElementById("tooltip");
                    tooltip.style.left = (e.pageX + 10) + "px";
                    tooltip.style.top = (e.pageY - 20) + "px";
                    tooltip.style.opacity = 1;
                    tooltip.innerHTML = `<strong>${d.id}</strong><br><small>${d.role}</small>`;
                    d3.select(e.target).transition().attr("r", 55).attr("stroke-width", 6);
                    playSound('hover');
                })
                .on("mouseout", (e) => {
                    document.getElementById("tooltip").style.opacity = 0;
                    d3.select(e.target).transition().attr("r", 45).attr("stroke-width", 4);
                });

            const label = g.append("g").selectAll("text")
                .data(nodes)
                .enter().append("text")
                .text(d => d.id)
                .attr("dy", 70)
                .attr("text-anchor", "middle")
                .style("font-weight", "bold")
                .style("font-family", "Nanum Myeongjo")
                .style("font-size", "1.1rem")
                .style("fill", "#222")
                .style("text-shadow", "1px 1px 0px white");

            simulation.on("tick", () => {
                linkLine
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                // ë§í¬ í…ìŠ¤íŠ¸ ìœ„ì¹˜ ê³„ì‚° (ì¤‘ê°„)
                linkText
                    .attr("x", d => (d.source.x + d.target.x) / 2)
                    .attr("y", d => (d.source.y + d.target.y) / 2);

                // í…ìŠ¤íŠ¸ ë°°ê²½ ë°•ìŠ¤ í¬ê¸° ì¡°ì ˆ
                linkLabelRect
                    .attr("x", d => ((d.source.x + d.target.x) / 2) - (d.label.length * 5 + 5))
                    .attr("y", d => ((d.source.y + d.target.y) / 2) - 10)
                    .attr("width", d => d.label.length * 10 + 10)
                    .attr("height", 20);

                node
                    .attr("cx", d => d.x)
                    .attr("cy", d => d.y);

                label
                    .attr("x", d => d.x)
                    .attr("y", d => d.y);
            });

            function dragStart(e, d) { if (!e.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; }
            function dragging(e, d) { d.fx = e.x; d.fy = e.y; }
            function dragEnd(e, d) { if (!e.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; }
        }
    </script>

</body>

</html>